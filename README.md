[![CircleCI](https://dl.circleci.com/insights-snapshot/gh/BNNJ/Project13/master/deploy/badge.svg?window=30d)](https://app.circleci.com/insights/github/BNNJ/Project13/workflows/deploy/overview?branch=master&reporting-window=last-30-days&insights-snapshot=true)

# Orange County Lettings

OpenClassrooms project 13

[Original doc (in french)](README_oc.md)

## Description

This project is an exercice in continuous integration and continuous deployment.
It uses CircleCi, Dockerhub and Heroku.

Here's a quick recap of the workflow:
- Updates to github's Main/Master branch should trigger the pipeline on CircleCi.
- The CircleCi's pipeline first makes a test build, runs tests and linting
- If both pass, a docker image is produced and pushed to Dockerhub
- The image is then pulled from dockerhub and pushed to Heroku to make the app publicly accessible

## Requirements

- git CLI
- pip
- python 3.6+

environment variables:
- SENTRY_DSN
- PORT 

## Setup

Clone the project:
```sh
git clone https://github.com/BNNJ/Project13.git {path/to/project}
```
Go to the project directory:
```sh
cd {path/to/project}
``` 
Create a virtual environment:
```sh
python -m venv venv
```
Activate the environment (unix):
```sh
source venv/bin/activate
```
Windows PowerShell:
```sh
.\venv\Scripts\Activate.ps1
```
Install the dependencies:
```sh
pip install -r requirements.txt
```

## Usage

tests:
```sh
python manage.py test
```
linting:
```sh
flake8
```
Start the server:
```sh
python manage.py runserver
```
You can now access the app from `localhost:8000` from your browser

## Docker

Pull the image from dockerhub:
```sh
docker pull bnnj/oc-lettings-pf:latest
```
Instanciate a container from the image:
```sh
docker run --name {container_name} -e PORT=8000 -e SENTRY_DSN={sentry_dsn} -p 8000:8000 -d bnnj/oc-lettings-pf
```
- `--name {container_name}` will make the container use a specific name instead of being generated by docker
- `-e PORT=8000` provides an environment variable with the port the container will use
- `-e SENTRY_DSN={sentry_dsn}` provides an environment variable with the Data Source Name that Sentry will use
- `-p 8000:8000` binds the port you'll use from your machine to the port docker uses
- `-d` detaches the process from the terminal


You can now access the app from `localhost:8000` from your browser

Start and stop the container:
```sh
docker start {container_name}
docker stop {container_name}
```

## Heroku

Open {foo} in your browser.

